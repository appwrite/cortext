.milkdown {
  /* Light mode colors based on app's CSS variables */
  --crepe-color-background: var(--background);
  --crepe-color-on-background: var(--foreground);
  --crepe-color-surface: var(--card);
  --crepe-color-surface-low: var(--muted);
  --crepe-color-on-surface: var(--card-foreground);
  --crepe-color-on-surface-variant: oklch(0.4 0 0); /* More visible than muted-foreground */
  --crepe-color-outline: var(--border);
  --crepe-color-primary: var(--primary);
  --crepe-color-secondary: var(--secondary);
  --crepe-color-on-secondary: var(--secondary-foreground);
  --crepe-color-inverse: var(--accent);
  --crepe-color-on-inverse: var(--accent-foreground);
  --crepe-color-inline-code: var(--destructive);
  --crepe-color-error: var(--destructive);
  --crepe-color-hover: var(--accent);
  --crepe-color-selected: #ffeb3b; /* Bright yellow marker color */
  --crepe-color-inline-area: var(--muted);

  /* Typography matching app's font system */
  --crepe-font-title: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
  --crepe-font-default: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
  --crepe-font-code: ui-monospace, SFMono-Regular, 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace;

  /* Font sizes matching Tailwind's scale */
  --crepe-font-size-xs: 0.75rem;     /* 12px - text-xs */
  --crepe-font-size-sm: 0.875rem;    /* 14px - text-sm */
  --crepe-font-size-base: 1rem;      /* 16px - text-base */
  --crepe-font-size-lg: 1.125rem;    /* 18px - text-lg */
  --crepe-font-size-xl: 1.25rem;     /* 20px - text-xl */
  --crepe-font-size-2xl: 1.5rem;     /* 24px - text-2xl */
  --crepe-font-size-3xl: 1.875rem;   /* 30px - text-3xl */
  --crepe-font-size-4xl: 2.25rem;    /* 36px - text-4xl */
  --crepe-font-size-5xl: 3rem;       /* 48px - text-5xl */

  /* Font weights matching app's usage */
  --crepe-font-weight-normal: 400;   /* font-normal */
  --crepe-font-weight-medium: 500;   /* font-medium */
  --crepe-font-weight-semibold: 600; /* font-semibold */
  --crepe-font-weight-bold: 700;     /* font-bold */

  /* Line heights for better readability */
  --crepe-line-height-tight: 1.25;
  --crepe-line-height-normal: 1.5;
  --crepe-line-height-relaxed: 1.625;

  /* Subtle shadows that work with the app's design */
  --crepe-shadow-1:
    0px 1px 3px 1px rgba(0, 0, 0, 0.1), 0px 1px 2px 0px rgba(0, 0, 0, 0.06);
  --crepe-shadow-2:
    0px 2px 6px 2px rgba(0, 0, 0, 0.1), 0px 1px 2px 0px rgba(0, 0, 0, 0.06);
}

/* Override heading sizes to match app's more modest typography with very light font weights */
.milkdown .ProseMirror h1 {
  font-size: 1.5rem !important;     /* 24px - text-2xl */
  line-height: 1.25 !important;     /* tight line height */
  margin-top: 1.5rem !important;    /* 24px */
  margin-bottom: 0.75rem !important; /* 12px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h1::after {
  content: ' h1' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

.milkdown .ProseMirror h2 {
  font-size: 1.25rem !important;     /* 20px - text-xl */
  line-height: 1.25 !important;      /* tight line height */
  margin-top: 1.25rem !important;    /* 20px */
  margin-bottom: 0.5rem !important;  /* 8px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h2::after {
  content: ' h2' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

.milkdown .ProseMirror h3 {
  font-size: 1.125rem !important;    /* 18px - text-lg */
  line-height: 1.25 !important;      /* tight line height */
  margin-top: 1rem !important;       /* 16px */
  margin-bottom: 0.5rem !important;  /* 8px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h3::after {
  content: ' h3' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

.milkdown .ProseMirror h4 {
  font-size: 1rem !important;        /* 16px - text-base */
  line-height: 1.25 !important;     /* tight line height */
  margin-top: 0.75rem !important;    /* 12px */
  margin-bottom: 0.25rem !important; /* 4px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h4::after {
  content: ' h4' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

.milkdown .ProseMirror h5 {
  font-size: 0.875rem !important;    /* 14px - text-sm */
  line-height: 1.25 !important;      /* tight line height */
  margin-top: 0.75rem !important;    /* 12px */
  margin-bottom: 0.25rem !important; /* 4px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h5::after {
  content: ' h5' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

.milkdown .ProseMirror h6 {
  font-size: 0.75rem !important;     /* 12px - text-xs */
  line-height: 1.25 !important;      /* tight line height */
  margin-top: 0.75rem !important;    /* 12px */
  margin-bottom: 0.25rem !important; /* 4px */
  font-weight: 400 !important;       /* font-normal - very light */
  position: relative !important;    /* For pseudo element positioning */
}

.milkdown .ProseMirror h6::after {
  content: ' h6' !important;
  position: static !important;
  font-size: 0.75rem !important;     /* 12px - text-xs */
  color: #9ca3af !important;         /* gray-400 */
  font-weight: 400 !important;
  opacity: 0.7 !important;
  margin-left: 0.5rem !important;   /* Add some space after title */
}

/* Set very light font weight for default text */
.milkdown .ProseMirror p {
  font-weight: 300 !important;
  margin-bottom: 20px !important;       /* font-light - very light */
}

.milkdown .ProseMirror {
  font-weight: 300 !important;       /* font-light for all text content */
}

/* Ensure bold text appears properly bold */
.milkdown .ProseMirror strong,
.milkdown .ProseMirror b {
  font-weight: 700 !important;       /* font-bold - very bold to contrast with light base */
}

/* Ensure other emphasis elements are visible */
.milkdown .ProseMirror em,
.milkdown .ProseMirror i {
  font-style: italic !important;
}

/* Make sure inline code stands out */
.milkdown .ProseMirror code {
  font-weight: 500 !important;       /* font-medium for code */
  background-color: var(--crepe-color-surface-low) !important;
  padding: 0.125rem 0.25rem !important;
  border-radius: 0.25rem !important;
}

/* Improve visibility of bullet points and list items */
.milkdown .ProseMirror ul,
.milkdown .ProseMirror ol {
  color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}

.milkdown .ProseMirror li {
  color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}

.milkdown .ProseMirror li p {
  margin-bottom: 0 !important;
}

/* Improve visibility of operation buttons and toolbar elements */
.milkdown .toolbar button,
.milkdown .toolbar .button,
.milkdown [role="button"] {
  color: oklch(0.4 0 0) !important; /* More visible than default muted color */
}

.milkdown .toolbar button:hover,
.milkdown .toolbar .button:hover,
.milkdown [role="button"]:hover {
  color: oklch(0.2 0 0) !important; /* Even more visible on hover */
}

/* Fix visibility of specific UI elements - bullet points, numbers, plus icons, drag handles */
.milkdown .milkdown-list-item-block li .label-wrapper,
.milkdown .milkdown-list-item-block li .label-wrapper .label {
  color: oklch(0.3 0 0) !important; /* Darker for better visibility */
}

.milkdown .milkdown-list-item-block li .label-wrapper svg {
  fill: oklch(0.3 0 0) !important; /* Darker for better visibility */
}

/* Plus icons and operation buttons */
.milkdown .milkdown-block-handle .operation-item svg {
  fill: oklch(0.3 0 0) !important; /* Darker for better visibility */
}

/* Drag handles and indicators */
.milkdown .milkdown-table-block svg {
  fill: oklch(0.3 0 0) !important; /* Darker for better visibility */
}

.milkdown .milkdown-table-block .cell-handle {
  color: oklch(0.3 0 0) !important; /* Darker for better visibility */
}

/* Drag lines - make them match regular text color */
.milkdown .milkdown-table-block .line-handle {
  background-color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}


/* Drop indicator lines - make them match regular text color */
.milkdown .crepe-drop-cursor {
  background-color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}

.milkdown .ProseMirror-gapcursor:after {
  border-top: 1px solid var(--crepe-color-on-surface) !important; /* Match regular text color */
}

/* Dark mode support using CSS custom properties */
.dark .milkdown {
  --crepe-color-background: var(--background);
  --crepe-color-on-background: var(--foreground);
  --crepe-color-surface: var(--card);
  --crepe-color-surface-low: var(--muted);
  --crepe-color-on-surface: var(--card-foreground);
  --crepe-color-on-surface-variant: oklch(0.8 0 0); /* More visible than muted-foreground in dark mode */
  --crepe-color-outline: var(--border);
  --crepe-color-primary: var(--primary);
  --crepe-color-secondary: var(--secondary);
  --crepe-color-on-secondary: var(--secondary-foreground);
  --crepe-color-inverse: var(--accent);
  --crepe-color-on-inverse: var(--accent-foreground);
  --crepe-color-inline-code: var(--destructive);
  --crepe-color-error: var(--destructive);
  --crepe-color-hover: var(--accent);
  --crepe-color-selected: #ffeb3b; /* Bright yellow marker color */
  --crepe-color-inline-area: var(--muted);
}

/* Dark mode specific UI element visibility fixes */
.dark .milkdown .milkdown-list-item-block li .label-wrapper,
.dark .milkdown .milkdown-list-item-block li .label-wrapper .label {
  color: oklch(0.7 0 0) !important; /* Brighter for dark mode */
}

.dark .milkdown .milkdown-list-item-block li .label-wrapper svg {
  fill: oklch(0.7 0 0) !important; /* Brighter for dark mode */
}

.dark .milkdown .milkdown-block-handle .operation-item svg {
  fill: oklch(0.7 0 0) !important; /* Brighter for dark mode */
}

.dark .milkdown .milkdown-table-block svg {
  fill: oklch(0.7 0 0) !important; /* Brighter for dark mode */
}

.dark .milkdown .milkdown-table-block .cell-handle {
  color: oklch(0.7 0 0) !important; /* Brighter for dark mode */
}

.dark .milkdown .milkdown-table-block .line-handle {
  background-color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}

/* Dark mode drop indicator lines */
.dark .milkdown .crepe-drop-cursor {
  background-color: var(--crepe-color-on-surface) !important; /* Match regular text color */
}

.dark .milkdown .ProseMirror-gapcursor:after {
  border-top: 1px solid var(--crepe-color-on-surface) !important; /* Match regular text color */
}

/* Customize toolbar/action bar for cortext theme */
.milkdown .milkdown-toolbar {
  background-color: var(--crepe-color-on-background) !important; /* Same as text color */
  color: var(--crepe-color-background) !important; /* Same as background color */
  box-shadow: none !important; /* Remove shadow */
  border-radius: 0.5rem !important; /* Match app card border radius */
}

.milkdown .milkdown-toolbar .toolbar-item {
  color: var(--crepe-color-background) !important; /* Same as background color */
}

.milkdown .milkdown-toolbar .toolbar-item:hover {
  background-color: rgba(255, 255, 255, 0.1) !important; /* Light hover effect */
}

.milkdown .milkdown-toolbar .toolbar-item:active {
  background-color: rgba(255, 255, 255, 0.2) !important; /* Active state */
}

.milkdown .milkdown-toolbar .toolbar-item svg {
  color: var(--crepe-color-background) !important; /* Same as background color */
  fill: var(--crepe-color-background) !important; /* Same as background color */
}

.milkdown .milkdown-toolbar .toolbar-item.active svg {
  opacity: 0.6 !important; /* 60% opacity for active state */
}

.milkdown .milkdown-toolbar .divider {
  width: 1px !important; /* Ensure width is set */
  height: 24px !important; /* Ensure height is set */
  background-color: rgba(0, 0, 0, 0.2) !important; /* More visible opacity */
  margin: 0 4px !important; /* Add some spacing */
}

/* Ensure table text is vertically aligned to top */
.milkdown .ProseMirror table,
.milkdown .ProseMirror table td,
.milkdown .ProseMirror table th {
  vertical-align: top !important;
}

.milkdown .ProseMirror table td,
.milkdown .ProseMirror table th {
  padding-top: 0.5rem !important;
  padding-bottom: 0.5rem !important;
}

/* Make selected text color always black while keeping yellow background */
.milkdown .ProseMirror *::selection {
  background: var(--crepe-color-selected) !important; /* Keep yellow background */
  color: #000000 !important; /* Always black text */
}

.milkdown .ProseMirror *::-moz-selection {
  background: var(--crepe-color-selected) !important; /* Keep yellow background */
  color: #000000 !important; /* Always black text */
}

/* Override blockquote border to use default text color instead of yellow selection color */
.milkdown .ProseMirror blockquote::before {
  background: var(--crepe-color-on-background) !important; /* Use default text color */
}

/* Style HR divider as 3 centered circles using CSS */
.milkdown .ProseMirror hr {
  border: none !important;
  height: 20px !important;
  margin: 2rem 0 !important; /* Add some spacing */
  position: relative !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background-color: transparent !important; /* No background color */
}

.milkdown .ProseMirror hr::before {
  content: '' !important;
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 60px !important;
  height: 6px !important;
  background-image: 
    radial-gradient(circle, var(--crepe-color-on-background) 2px, transparent 2px),
    radial-gradient(circle, var(--crepe-color-on-background) 2px, transparent 2px),
    radial-gradient(circle, var(--crepe-color-on-background) 2px, transparent 2px);
  background-size: 6px 6px, 6px 6px, 6px 6px;
  background-position: 0% 50%, 50% 50%, 100% 50%;
  background-repeat: no-repeat;
}

/* Prevent layout shift when HR is selected */
.milkdown .ProseMirror hr.ProseMirror-selectednode {
  margin: 2rem 0 !important; /* Maintain margin when selected */
  position: relative !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background-color: var(--crepe-color-selected) !important; /* Yellow background when selected */
  color: #000000 !important; /* Black text when selected */
}

.milkdown .ProseMirror hr.ProseMirror-selectednode::before {
  content: '' !important;
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 60px !important;
  height: 6px !important;
  background-image: 
    radial-gradient(circle, #000000 2px, transparent 2px),
    radial-gradient(circle, #000000 2px, transparent 2px),
    radial-gradient(circle, #000000 2px, transparent 2px);
  background-size: 6px 6px, 6px 6px, 6px 6px;
  background-position: 0% 50%, 50% 50%, 100% 50%;
  background-repeat: no-repeat;
}

/* Style slash menu to match actions bar - override block-edit.css */
.milkdown .milkdown-slash-menu {
  background: var(--crepe-color-on-background) !important; /* Same as text color */
  color: var(--crepe-color-background) !important; /* Same as background color */
  box-shadow: none !important; /* Remove shadow */
  border-radius: 0.5rem !important; /* Match app card border radius */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li {
  color: var(--crepe-color-background) !important; /* Same as background color */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li:hover,
.milkdown .milkdown-slash-menu .menu-groups .menu-group li.hover {
  background: rgba(255, 255, 255, 0.1) !important; /* Light hover effect */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li:active,
.milkdown .milkdown-slash-menu .menu-groups .menu-group li.active {
  background: rgba(255, 255, 255, 0.2) !important; /* Active state */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li svg {
  color: var(--crepe-color-background) !important; /* Same as background color */
  fill: var(--crepe-color-background) !important; /* Same as background color */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li.active svg {
  opacity: 0.6 !important; /* 60% opacity for active state */
}

.milkdown .milkdown-slash-menu .menu-groups .menu-group li > span {
  color: var(--crepe-color-background) !important; /* Same as background color */
}

/* Add arrow pointing from toolbar to selected text */
.milkdown .milkdown-toolbar {
  overflow: visible !important; /* Ensure arrow is visible */
}

.milkdown .milkdown-toolbar::after {
  content: '' !important;
  position: absolute !important;
  bottom: -8px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 0 !important;
  height: 0 !important;
  border-left: 8px solid transparent !important;
  border-right: 8px solid transparent !important;
  border-top: 8px solid #000000 !important; /* Use black for better visibility */
  z-index: 30 !important; /* Higher than toolbar z-index */
  pointer-events: none !important; /* Don't interfere with clicks */
}

/* Style links with same blue background as unpublished changes alert - cortext theme only */
.milkdown .ProseMirror a {
  background-color: rgba(239, 246, 255, 0.9) !important; /* blue-50/90 - same as unpublished alert */
  padding: 0.125rem 0.25rem !important;
  border-radius: 0.25rem !important;
  text-decoration: none !important;
  transition: background-color 0.2s ease !important;
}

.milkdown .ProseMirror a:hover {
  background-color: rgba(239, 246, 255, 1) !important; /* blue-50 full opacity on hover */
}

/* Dark mode link styling to match unpublished changes alert - cortext theme only */
.dark .milkdown .ProseMirror a {
  background-color: rgba(30, 58, 138, 0.5) !important; /* blue-950/50 - same as unpublished alert dark mode */
}

.dark .milkdown .ProseMirror a:hover {
  background-color: rgba(30, 58, 138, 0.7) !important; /* blue-950 with higher opacity on hover */
}
